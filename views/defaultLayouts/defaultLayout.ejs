<!DOCTYPE html>
<html lang="en" data-textdirection="ltr" class="loading">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
  <title>
    <%= title %>
  </title>
  <link rel="shortcut icon" type="image/x-icon" href="/images/logo.ico">
  <link
    href="https://fonts.googleapis.com/css?family=Montserrat:300,300i,400,400i,500,500i%7COpen+Sans:300,300i,400,400i,600,600i,700,700i"
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Josefin+Sans|Josefin+Slab" rel="stylesheet">
  <!-- Put small css here to avoid looking up a lot of stylesheets-->
  <style>
    .brand-text {
      font-family: 'Josefin Sans', sans-serif;
    }

    @media (max-width: 500px) {
      .brand-logo {
        width: 16px;
        height: 26px;
      }
      .brand-text {
        font-size: 20px;
      }
    }
  
    li{list-style: none;}

    .btn-success {
      border-color: #10C888 !important;
      background-color: #16D39A !important;
      color: #FFFFFF; }
    .btn-info {
      border-color: #22C2DC !important;
      background-color: #2DCEE3 !important;
      color: #FFFFFF; }
    .btn-warning {
      border-color: #FF976A !important;
      background-color: #FFA87D !important;
      color: #FFFFFF; }
    .bg-red {
      background-color: #F44336 !important; }
    .bg-red.bg-accent-2 {
      background-color: #FF5252 !important; }
    .bg-pink.bg-lighten-3 {
      background-color: #F48FB1 !important; }
    .bg-pink {
      background-color: #E91E63 !important; }
    .bg-blue.bg-darken-4 {
       background-color: #0D47A1 !important; }
    .bg-blue.bg-lighten-1 {
      background-color: #42A5F5 !important; }
    .bg-blue {
      background-color: #2196F3 !important; }
    .bg-teal.bg-lighten-1 {
      background-color: #26A69A !important; }
    .bg-teal.bg-darken-1 {
      background-color: #00897B !important; }
    .bg-amber {
      background-color: #FFC107 !important; }
    .bg-amber.bg-darken-1 {
      background-color: #FFB300 !important; }
    .bg-purple {
      background-color: #9C27B0 !important; }
    .bg-cyan.bg-lighten-1 {
      background-color: #26C6DA !important; }

    /* For login, register pages*/
    .form-simple input[type="text"] {
      margin-bottom: -1px;
      border-bottom-right-radius: 0;
      border-bottom-left-radius: 0; }

    .form-simple input[type="mail"] {
      margin-bottom: -1px;
      border-top-left-radius: 0;
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
      border-bottom-left-radius: 0; }

    .form-simple input[type="password"] {
      margin-bottom: 10px;
      border-top-left-radius: 0;
      border-top-right-radius: 0; }

    .help-block ul {
      margin: 0  !important;
      padding: 0 !important; }
      .help-block ul li {
        list-style: none; }
    /* End */
  </style>

  <!-- BEGIN VENDOR CSS-->
  <link rel="stylesheet" type="text/css" href="../../../app-assets/css/bootstrap.css">
  <link rel="stylesheet" type="text/css" href="../../../app-assets/fonts/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="../../../app-assets/fonts/feather/style.min.css">
  <link rel="stylesheet" type="text/css" href="../../../app-assets/vendors/css/forms/tags/tagging.css">
  <link rel="stylesheet" type="text/css" href="../../../app-assets/vendors/css/extensions/toastr.css">
  <link rel="stylesheet" type="text/css" href="../../../app-assets/vendors/css/ui/prism.min.css">
  <!-- END VENDOR CSS-->
  <!-- BEGIN STACK CSS-->
  <link rel="stylesheet" type="text/css" href="../../../app-assets/css/app.css">
  <link rel="stylesheet" type="text/css" href="../../../app-assets/css/bootstrap-extended.css">
  <!-- <link rel="stylesheet" type="text/css" href="../../../app-assets/css/colors.css"> --> <!-- Put colors inline between style tags instead -->
  <!-- END STACK CSS-->
  <!-- BEGIN Page Level CSS-->
  <link rel="stylesheet" type="text/css" href="../../../app-assets/css/core/menu/menu-types/vertical-menu.css">
  <!-- <link rel="stylesheet" type="text/css" href="../../../app-assets/css/pages/login-register.css"> -->
  <!-- END Page Level CSS-->
  <!-- BEGIN Custom CSS-->
  <!-- <link rel="stylesheet" type="text/css" href="../../../assets/css/autocomplete.css"> -->
  <!-- END Custom CSS-->
  <!-- END -->
  <!-- Jquery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!-- END -->
  <% if (currentAcc.username != 'chancemap_admin') { %>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-149591829-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-149591829-1');
  </script>
  <% } %>
</head>

<body data-open="click" data-menu="vertical-menu" data-col="2-columns"
  class="vertical-layout vertical-menu 2-columns menu-expanded fixed-navbar">
  <!-- navbar-fixed-top-->
  <nav class="header-navbar navbar navbar-with-menu navbar-fixed-top navbar-dark">
    <div class="navbar-wrapper">
      <div class="navbar-header">
        <ul class="nav navbar-nav">
          <li id="brandTitle" class="nav-item"><a href="/" class="navbar-brand"><img alt="stack admin logo"
                src="/images/w_logo.png" witdh="16" height="32" class="brand-logo">
              <h2 class="brand-text">ChanceMap</h2>
            </a></li>
        </ul>
      </div>
      <div class="navbar-container content container-fluid">
        <div id="navbar-mobile" class="collapse navbar-toggleable-sm">
          <ul class="nav navbar-nav mr-auto float-left">
            <li class="nav-item d-xs-none d-md-block"><a class="nav-link nav-menu-main menu-toggle hidden-xs is-active" href=""><i class="ft-menu"></i></a></li>
          </ul>
          <ul style="margin-right: 50px" class="nav navbar-nav float-xs-right">

            <% if(currentAcc.username !== 'chancemap_admin') { %>
            <!-- user connect noti -->
            <li class="dropdown dropdown-notification nav-item">
              <a id="msg_noti" href="#" data-toggle="dropdown" class="nav-link nav-link-label"><i
                  class="ficon ft-users"></i>
                <% if(currentAcc.connect_received) { %>
                <span class="noti_count tag tag-pill tag-default tag-danger tag-default tag-up" id="req_count">
                  <%= currentAcc.connect_received.length %>
                </span>
                <% } else { %>
                <span class="noti_count tag tag-pill tag-default tag-danger tag-default tag-up" id="req_count">
                  0
                </span>
                <% } %>
              </a>
              <% if (account_type == 0) { %>
              <ul class="dropdown-menu dropdown-menu-media dropdown-menu-right">
                <li class="dropdown-menu-header">
                  <h6 class="dropdown-header m-0"><span class="grey darken-2">Requests</span>
                </li>
                <li id="connect_noti" class="list-group scrollable-container ps-container ps-theme-dark ps-active-y"
                  data-ps-id="f63177ae-103d-18cc-b7ba-6373aaa089ef">

                  <% let connectRequests = users.filter(user => currentAcc.connect_received.indexOf(user.username) >= 0) %>
                  <% connectRequests.forEach(user => { %>
                  <% if (account_type == 0 && currentAcc.connected.indexOf(user.username) < 0 && currentAcc.connect_sent.indexOf(user.username) < 0 && currentAcc.connect_received.indexOf(user.username) >= 0) { %>
                  <a id="<%=user._id%>-connect" href="javascript:void(0)" class="list-group-item">
                    <div class="media-body">
                      <div class="media-left valign-middle">
                        <img src="<%= user.avatar %>" class="media-object rounded-circle"
                          style="max-width: 40px; max-height: 40px" />
                      </div>
                      <div class="media-left">
                        <strong>
                          <%= user.name %>
                        </strong>
                        <br><br>
                        <button class="connect_button btn btn-info"
                          onclick="acceptRequest(<%= JSON.stringify(currentAcc._id) %>, <%= JSON.stringify(user._id) %>, <%= JSON.stringify(user.username) %>)">Accept</button>
                      </div>
                    </div>
                  </a>
                  <%  } %>
                  <% }); %>
                  <div class="ps-scrollbar-x-rail" style="left: 0px; bottom: 3px;">
                    <div class="ps-scrollbar-x" tabindex="0" style="left: 0px; width: 0px;"></div>
                  </div>
                  <div class="ps-scrollbar-y-rail" style="top: 0px; height: 255px; right: 3px;">
                    <div class="ps-scrollbar-y" tabindex="0" style="top: 0px; height: 167px;"></div>
                  </div>
                </li>
              </ul>
              <% } %>
            </li>
            <% } %>

            <li class="dropdown dropdown-user nav-item">
              <a href="#" data-toggle="dropdown"
                class="dropdown-toggle nav-link dropdown-user-link">
                <span class="avatar avatar-online">
                  <img src="<%= currentAcc.avatar; %>" alt="avatar" id="<%= currentAcc.username %>AVATAR">
                  <i></i>
                </span>
                <span class="user-name"> <%= currentAcc.username; %></span>
              </a>
              <div class="dropdown-menu dropdown-menu-right">
                <% if (account_type != 2) { %>
                <a href="/profile" class="dropdown-item">
                  <i class="ft-user"></i> Edit Profile
                </a>
                <div class="dropdown-divider"></div>
                <% } %>
                <a href="/logout" class="dropdown-item">
                  <i class="ft-power"></i> Logout
                </a>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </nav>

  <!-- ////////////////////////////////////////////////////////////////////////////-->
    <% if(account_type == 1) { %>
    <%- include('nav_menu_org'); %>
    <% } else if (account_type == 0){ %>
    <%- include('nav_menu_user'); %>
    <% } else { %>
    <%- include('nav_menu_admin'); %>
    <% } %>
    <%- include('feedbackCardModal', {id: 'feedback'}); %>
    <%- content %>  

  <!-- DEFAULT SCRIPTS -->
  <!-- BEGIN VENDOR JS-->
  <script src="../../../app-assets/vendors/js/vendors.min.js" type="text/javascript"></script>
  <!-- BEGIN VENDOR JS-->
  <!-- BEGIN PAGE VENDOR JS-->
  <script src="../../../app-assets/vendors/js/forms/validation/jqBootstrapValidation.js"
    type="text/javascript"></script>
  <!-- <script src="../../../app-assets/vendors/js/forms/tags/bootstrap-tagsinput.min.js" type="text/javascript"></script> -->
  <!-- <script src="../../../app-assets/vendors/js/forms/extended/typeahead/typeahead.bundle.min.js"
    type="text/javascript"></script> --> <!-- Remove comments to use these scripts for type ahead and auto complete -->
  <script src="../../../app-assets/vendors/js/forms/tags/tagging.min.js" type="text/javascript"></script>
  <script src="../../../app-assets/vendors/js/ui/prism.min.js" type="text/javascript"></script>
  <script src="../../../app-assets/vendors/js/extensions/toastr.min.js" type="text/javascript"></script>
  <% if ( title  == 'ChanceMap | Calendar') { %>
  <script src="../../../app-assets/vendors/js/extensions/moment.min.js" type="text/javascript"></script>
  <script src="../../../app-assets/vendors/js/extensions/fullcalendar.min.js" type="text/javascript"></script>
  <% } %>
  <!-- END PAGE VENDOR JS-->
  <!-- BEGIN STACK JS-->
  <script src="../../../app-assets/js/core/app-menu.js" type="text/javascript"></script>
  <script src="../../../app-assets/js/core/app.js" type="text/javascript"></script>
  <!-- END STACK JS-->
  <!-- BEGIN PAGE LEVEL JS-->
  <script src="../../../app-assets/js/scripts/forms/tags/tagging.js" type="text/javascript"></script>
  <!-- <script src="../../../app-assets/js/scripts/extensions/toastr.js" type="text/javascript"></script> -->
  <!-- END PAGE LEVEL JS-->
  <!-- BEGIN CODEDAO SCRIPT -->
  <!-- <script src="/scripts/defaultLayout.js" type="text/javascript"></script> -->
  <script>
    $(document).ready(function () {
      $.blockUI({
        overlayCSS: {
          opacity: 0
        },
        message: ''
      });
      setTimeout(() => {
        $.unblockUI();
      }, 1500);

      setTimeout(() => {
        // if (parseInt(getCookie("visitCount"), 10) >= 6 && getCookie("hasShownPopup") == 'false' ) {
        //   alert("YOU SHALL NOT PASS!!");
        //   $('#feedback').modal();
        //   setCookie("hasShownPopup", "true", 21);
        // }
      }, 10000);

      console.log("cookie is enabled? : " + navigator.cookieEnabled)
      if (navigator.cookieEnabled) {
        console.log(document.cookie);
        if (getCookie("visitCount") == "") {
          setCookie("visitCount", 1, 7);
        } else {
          let x = parseInt(getCookie("visitCount"), 10);
          setCookie("visitCount", x + 1, 7);
        }
        if (getCookie("hasShownPopup") == "") {
          setCookie("hasShownPopup", "false", 7);
        } 
      }

      // clearCookies(["visitCount", "hasShownPopup"]);

    });

    $.app.nav.init({speed: 300}); //initialize javascript handling menu-content before page finishes loading
    
    //cookies code (From w3school.com)
    function setCookie(cname, cvalue, exdays) {
      var expires;
      if (exdays != null) {
        var d = new Date();
        d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
        expires = "expires="+d.toUTCString();
      } else {
        expires = null;
      }
      document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
    }

    function getCookie(cname) {
      var name = cname + "=";
      var ca = document.cookie.split(';');
      for(var i = 0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') {
          c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
          return c.substring(name.length, c.length);
        }
      }
      return "";
    }

    function clearCookies(list) {
      list.forEach(cookie => {
        document.cookie = cookie + '=1 ; expires=Thu, 18 Dec 1970 12:00:00 UTC; path=/'
      });
      console.log(document.cookie);
    }
    //end cookies code

    //popup code
    function showFeedback() {
      let popup = document.getElementById('embedded_feedback');
      let prompt = document.getElementById('prompt');
      console.log(prompt);
      prompt.style['display'] = 'none';
      popup.style['display'] = 'block';
    }

    function close() {
      $('#feedback').modal();
    }

    //end popup code

  </script>

  <!-- END -->
</body>

</html>