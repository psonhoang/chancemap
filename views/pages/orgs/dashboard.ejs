<% extend('../../defaultLayouts/defaultLayout.ejs'); %>

<div class="app-content content container-fluid">
	<div class="content-wrapper">
	  <div class="content-header row">
	    <div class="content-header-left col-md-6 col-xs-12 mb-2">
	      <h3 class="content-header-title mb-0">Organizations</h3>
	      <div class="row breadcrumbs-top">
	        <div class="breadcrumb-wrapper col-xs-12">
	          <ol class="breadcrumb">
	            <li class="breadcrumb-item"><a href="/">Home</a>
	            </li>
	            <li class="breadcrumb-item"><a href="/job">Dashboard</a>
	            </li>
	            <li class="breadcrumb-item active">Orgs
	            </li>
	          </ol>
	        </div>
	      </div>
	    </div>
	   </div>
	   <div class="row">
		   	<div class="container-fluid">
	          <button onclick="search()" class="col-xl-1 col-lg-2 btn btn-info" type="button"><i class="ft-search font-md-4"></i> Search</button>
	          <div class="col-xl-11 col-lg-10">
	              <div id="search-input" class="edit-on-delete form-control tagging" data-tags-input-name="add-box">
	                <input class="type-zone" contenteditable="true">
	              </div>
	              <p class="text-muted">Search for organizations with keywords (Ex: charity, design, culture,...)</p>
	          </div>
	        </div>
	   </div>
	  </div>
 	<div class="content-body">
	 	<div class="col-md-12">
	        <!-- Orgs -->
	        <div style="margin-left: 5px; margin-right: 5px">
	          <div class="card">
	              <div style="color: white" class="card-header bg-teal">
	                <h4 class="card-title"><i class="ft-users"></i> Organizations</h4>
	                <a class="heading-elements-toggle">
	                  <i class="fa fa-ellipsis-v font-medium-3"></i>
	                </a>
	              </div>
	              <div class="card-body collapse-in">
	                <div class="table-responsive">
	                  <table class="table">
	                    <thead style="color: white" class="thead bg-blue-grey bg-darken-3">
	                      <tr>
	                        <th>Avatar</th>
	                        <th style="text-align: center">Organization</th> <!-- Includes info: event name, org, location, time, tags -->
	                        <th>#</th>
	                      </tr>
	                    </thead>
	                    <tbody id="orgsBody">
	                      <% orgs.forEach(org => { %>
	                        <% if (org.username != currentAcc.username) { %>
	                          <tr>
	                            <td><img src="<%= org.avatar; %>" class="rounded-circle width-100 height-100" alt="org avatar"></td>
	                            <td>
	                              <ul>
	                                <li style="font-size: 16px"><strong><%= org.name %></strong></li>
	                                <li style="font-style: italic">@<%= org.username %></li>
	                                <% if (org.facebook) { %>
	                                  <li style="font-style: small"><i class="ft-facebook"></i> <%= org.facebook %></li>
	                                <% } %>
	                                <% if (org.email) { %>
	                                  <li style="font-size: small;"><i class="ft-mail"></i> <%= org.email %></li>
	                                <% } %>
	                                <% if (org.website) { %>
	                                  <li style="font-size: small"><i class="ft-globe"></i> <%= org.website %></li>
	                                <% } %>
	                                <li style="font-size: small">About: <%= org.desc %></li>
	                              </ul>
	                            </td>
	                            <td>
	                              <% org.hashtags.forEach(hashtag => { %>
	                                <% var isMatch = false; %>
	                                <% criteriaList.forEach(criteria => { %>
	                                  <% if (hashtag.includes(criteria) && !isMatch) { %>
	                                    <% isMatch = true; %>
	                                    <span style="font-size: 14px" class="tag tag-pill tag-warning"><%= hashtag; %></span>
	                                  <% } %>
	                                <% }); %>
	                                <% if (!isMatch) { %>
	                                  <span style="font-size: 14px" class="tag tag-pill tag-info"><%= hashtag; %></span>
	                                <% } %>
	                              <% }); %>
	                            </td>
	                          </tr>
	                        <% } %>
	                      <% }); %>
	                    </tbody>
	                  </table>
	                </div>
	              </div>
	          </div>
	        </div>		
	 	</div>
</div>

<!--  BEGIN CODEDAO SCRIPT -->
<script>
  $(document).ready(function() {
    $('#search-input').tagging('removeAll');
  });

  function search() {
    let x = document.getElementById('search-input');
    let tags = x.getElementsByTagName('div');
    let criteriaList = [];
    let inputValue;
    for (var i = 0; i < tags.length; i++) {
      inputValue = tags[i].getElementsByTagName('input')[0].value;
      criteriaList.push(inputValue);
    }
    // alert(criteriaList);
    $.ajax({
      async: true,
      url: '/search/orgs',
      method: 'GET',
      beforeSend: (req) => {
        $.blockUI();
      },
      data: {
        criteriaList: criteriaList
      },
      success: (data) => {
        console.log(typeof(data));
        document.open();
        document.write(data);
        document.close();
        $.unblockUI();
      }
    });
  }
</script>
<!-- END -->

